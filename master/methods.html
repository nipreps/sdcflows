<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Standalone command line usage" href="cli.html" /><link rel="prev" title="Susceptibility Distortions in a nutshell" href="notebooks/SDC%20-%20Theory%20and%20physics.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Methods and implementation - sdcflows 0+unknown documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/css/version-switch.css?v=3fffbac3" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">sdcflows 0+unknown documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
    <span class="sidebar-brand-text">sdcflows</span>
    <span id="version-slug" class="sidebar-brand-text">0 (dev)</span>
</a>

<!-- Versions dropdown -->
<div id="version-menu" class="version-tree">
  <ul>
  <li class="toctree-l1 has-children">
  <span class="sidebar-brand-text">0 (dev)</span>
  <input class="toctree-checkbox" id="toctree-checkbox-v" name="toctree-checkbox-v" role="switch" type="checkbox">
  <label for="toctree-checkbox-v"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label>
  <ul id="v-tags"></ul>
  </ul>
</div><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="notebooks/SDC%20-%20Theory%20and%20physics.html">Susceptibility Distortions in a nutshell</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Methods and implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Standalone command line usage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">Library API (application program interface)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Library API (application program interface)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/sdcflows.cli.html">sdcflows.cli package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of sdcflows.cli package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.cli.main.html">sdcflows.cli.main module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.cli.parser.html">sdcflows.cli.parser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.cli.workflow.html">sdcflows.cli.workflow module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/sdcflows.config.html">sdcflows.config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/sdcflows.data.html">sdcflows.data package</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/sdcflows.fieldmaps.html">sdcflows.fieldmaps module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/sdcflows.interfaces.html">sdcflows.interfaces package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of sdcflows.interfaces package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.brainmask.html">sdcflows.interfaces.brainmask module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.bspline.html">sdcflows.interfaces.bspline module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.epi.html">sdcflows.interfaces.epi module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.fmap.html">sdcflows.interfaces.fmap module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.reportlets.html">sdcflows.interfaces.reportlets module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.interfaces.utils.html">sdcflows.interfaces.utils module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api/sdcflows.transform.html">sdcflows.transform module</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/sdcflows.utils.html">sdcflows.utils package</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of sdcflows.utils package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.bimap.html">sdcflows.utils.bimap module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.epimanip.html">sdcflows.utils.epimanip module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.misc.html">sdcflows.utils.misc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.phasemanip.html">sdcflows.utils.phasemanip module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.telemetry.html">sdcflows.utils.telemetry module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.tools.html">sdcflows.utils.tools module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.utils.wrangler.html">sdcflows.utils.wrangler module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/sdcflows.viz.html">sdcflows.viz package</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of sdcflows.viz package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.viz.utils.html">sdcflows.viz.utils module</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/sdcflows.workflows.html">sdcflows.workflows package</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of sdcflows.workflows package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="api/sdcflows.workflows.apply.html">sdcflows.workflows.apply package</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of sdcflows.workflows.apply package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.apply.correction.html">sdcflows.workflows.apply.correction module</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.apply.registration.html">sdcflows.workflows.apply.registration module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="api/sdcflows.workflows.fit.html">sdcflows.workflows.fit package</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of sdcflows.workflows.fit package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.fit.base.html">sdcflows.workflows.fit.base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.fit.fieldmap.html">sdcflows.workflows.fit.fieldmap module</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.fit.pepolar.html">sdcflows.workflows.fit.pepolar module</a></li>
<li class="toctree-l4"><a class="reference internal" href="api/sdcflows.workflows.fit.syn.html">sdcflows.workflows.fit.syn module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.workflows.ancillary.html">sdcflows.workflows.ancillary module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.workflows.base.html">sdcflows.workflows.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/sdcflows.workflows.outputs.html">sdcflows.workflows.outputs module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">What’s new?</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/methods.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="methods-and-implementation">
<h1>Methods and implementation<a class="headerlink" href="#methods-and-implementation" title="Link to this heading">¶</a></h1>
<p><em>SDCFlows</em> defines a clear <abbr title="application programming interface">API</abbr> that divides
the problem of susceptibility distortions (SD) into two stages:</p>
<ol class="arabic simple">
<li><p><strong>Estimation</strong>:
the MRI acquisitions in the protocol for <abbr title="susceptibility distortions">SD</abbr> are
discovered and preprocessed to estimate a map of B<sub>0</sub> non-uniformity in Hz (<span class="math notranslate nohighlight">\(\Delta B_0\)</span>).
The theory behind these distortions is well described in the literature (<a class="reference internal" href="#jezzard1995" id="id1"><span>[Jezzard1995]</span></a>, <a class="reference internal" href="#hutton2002" id="id2"><span>[Hutton2002]</span></a>),
and further discussed below (see a summary in <a class="reference internal" href="#fig-1"><span class="std std-numref">Fig. 1</span></a>).
<em>SDCFlows</em> builds on freely-available software to implement three major strategies for estimating
<span class="math notranslate nohighlight">\(\Delta B_0\)</span> (Eq. <span class="math notranslate nohighlight">\(\eqref{eq:fieldmap-1}\)</span>).
These strategies are described below, and implemented within <a class="reference internal" href="api/sdcflows.workflows.fit.html#module-sdcflows.workflows.fit" title="sdcflows.workflows.fit"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdcflows.workflows.fit</span></code></a>.</p></li>
<li><p><strong>Application</strong>:
the B-Spline basis coefficients used to represent the estimated <span class="math notranslate nohighlight">\(\Delta B_0\)</span> map mapped into the
target <abbr title="echo-planar imaging">EPI</abbr> scan to be corrected, and a displacement field in NIfTI
format that is compatible with ANTs is interpolated from the B-Spline basis.
The voxel location error along the <abbr title="phase-encoding">PE</abbr> will be proportional to <span class="math notranslate nohighlight">\(\Delta B_0 \cdot T_\text{ro}\)</span>,
where <span class="math notranslate nohighlight">\(T_\text{ro}\)</span> is the <em>total readout time</em> of the target <abbr title="echo-planar imaging">EPI</abbr> (<a class="reference internal" href="#fig-1"><span class="std std-numref">Fig. 1</span></a>).
The implementation of these workflows is found in the submodule <a class="reference internal" href="api/sdcflows.workflows.apply.html#module-sdcflows.workflows.apply" title="sdcflows.workflows.apply"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdcflows.workflows.apply</span></code></a>.</p></li>
</ol>
<figure class="align-center" id="id14">
<span id="fig-1"></span><a class="reference internal image-reference" href="_images/sdcflows-OHBM21-fig1.png"><img alt="_images/sdcflows-OHBM21-fig1.png" src="_images/sdcflows-OHBM21-fig1.png" style="width: 100%;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Susceptibility distortions in a nutshell</span><a class="headerlink" href="#id14" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#echo-planar-imaging-and-b0-mapping">Echo-planar imaging and *B0* mapping</a>.</p>
</div>
<section id="fieldmap-estimation-theory-and-methods">
<h2>Fieldmap estimation: theory and methods<a class="headerlink" href="#fieldmap-estimation-theory-and-methods" title="Link to this heading">¶</a></h2>
<p>The displacement suffered by every voxel along the <abbr title="phase-encoding">PE</abbr> direction
can be derived from Eq. (2) of <a class="reference internal" href="#hutton2002" id="id3"><span>[Hutton2002]</span></a>:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Delta_\text{PE} (i, j, k) = \gamma \cdot \Delta B_0 (i, j, k) \cdot T_\text{ro},
\label{eq:fieldmap-1}\tag{1}\]</div>
</div>
<p>where
<span class="math notranslate nohighlight">\(\Delta_\text{PE} (i, j, k)\)</span> is the <em>voxel-shift map</em> (VSM) along the <abbr title="phase-encoding">PE</abbr> direction,
<span class="math notranslate nohighlight">\(\gamma\)</span> is the gyromagnetic ratio of the H proton in Hz/T
(<span class="math notranslate nohighlight">\(\gamma = 42.576 \cdot 10^6 \, \text{Hz} \cdot \text{T}^\text{-1}\)</span>),
<span class="math notranslate nohighlight">\(\Delta B_0 (i, j, k)\)</span> is the <em>fieldmap variation</em> in T (Tesla), and
<span class="math notranslate nohighlight">\(T_\text{ro}\)</span> is the readout time of one slice of the <abbr title="echo-planar imaging">EPI</abbr> dataset
we want to correct for distortions.</p>
<p>Let <span class="math notranslate nohighlight">\(V\)</span> represent the <em>fieldmap</em> in Hz (or equivalently,
<em>voxel-shift-velocity map</em>, as Hz are equivalent to voxels/s), with
<span class="math notranslate nohighlight">\(V(i,j,k) = \gamma \cdot \Delta B_0 (i, j, k)\)</span>, then, introducing
the voxel zoom along the phase-encoding direction, <span class="math notranslate nohighlight">\(s_\text{PE}\)</span>,
we obtain the nonzero component of the associated displacements field
<span class="math notranslate nohighlight">\(\Delta D_\text{PE} (i, j, k)\)</span> that unwarps the target <abbr title="echo-planar imaging">EPI</abbr> dataset:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Delta D_\text{PE} (i, j, k) = V(i, j, k) \cdot T_\text{ro} \cdot s_\text{PE}.
\label{eq:fieldmap-2}\tag{2}\]</div>
</div>
<section id="direct-b0-mapping-sequences">
<span id="sdc-direct-b0"></span><h3>Direct B0 mapping sequences<a class="headerlink" href="#direct-b0-mapping-sequences" title="Link to this heading">¶</a></h3>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-3-direct-field-mapping">Types of fieldmaps - Case 3: Direct field mapping</a>
in the BIDS specification.</p>
</div>
<p>Some MR schemes such as <abbr title="spiral-echo imaging">SEI</abbr> can directly
reconstruct an estimate of <em>the fieldmap in Hz</em>, <span class="math notranslate nohighlight">\(V(i,j,k)\)</span>.
These <em>fieldmaps</em> are described with more detail <a class="reference external" href="https://cni.stanford.edu/wiki/GE_Processing#Fieldmaps">here</a>.</p>
</section>
<section id="phase-difference-b0-estimation">
<span id="sdc-phasediff"></span><h3>Phase-difference B0 estimation<a class="headerlink" href="#phase-difference-b0-estimation" title="Link to this heading">¶</a></h3>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-2-two-phase-maps-and-two-magnitude-images">Types of fieldmaps - Case 2: Two phase maps and two magnitude images</a>
in the BIDS specification.</p>
<p>Some scanners produce one <code class="docutils literal notranslate"><span class="pre">phasediff</span></code> map, where the drift between the two echos has
already been calculated, see the section
<a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-1-phase-difference-map-and-at-least-one-magnitude-image">Types of fieldmaps - Case 1: Phase-difference map and at least one magnitude image</a>.</p>
</div>
<p>The fieldmap variation in T, <span class="math notranslate nohighlight">\(\Delta B_0 (i, j, k)\)</span>, that is necessary to obtain
<span class="math notranslate nohighlight">\(\Delta_\text{PE} (i, j, k)\)</span> in Eq. <span class="math notranslate nohighlight">\(\eqref{eq:fieldmap-1}\)</span> can be
calculated from two subsequent <abbr title="Gradient-Recalled Echo">GRE</abbr> echoes,
via Eq. (1) of <a class="reference internal" href="#hutton2002" id="id4"><span>[Hutton2002]</span></a>:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Delta B_0 (i, j, k) = \frac{\Delta \Theta (i, j, k)}{2\pi \cdot \gamma \, \Delta\text{TE}},
\label{eq:fieldmap-3}\tag{3}\]</div>
</div>
<p>where
<span class="math notranslate nohighlight">\(\Delta \Theta (i, j, k)\)</span> is the phase-difference map in radians,
and <span class="math notranslate nohighlight">\(\Delta\text{TE}\)</span> is the elapsed time between the two GRE echoes.</p>
<p>For simplicity, the «<em>voxel-shift-velocity map</em>» <span class="math notranslate nohighlight">\(V(i,j,k)\)</span>, which we
can introduce in Eq. <span class="math notranslate nohighlight">\(\eqref{eq:fieldmap-2}\)</span> to directly obtain
the displacements field, can be obtained as:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[V(i, j, k) = \frac{\Delta \Theta (i, j, k)}{2\pi \cdot \Delta\text{TE}}.
\label{eq:fieldmap-4}\tag{4}\]</div>
</div>
<p>This calculation is further complicated by the fact that <span class="math notranslate nohighlight">\(\Theta_i\)</span>
(and therefore, <span class="math notranslate nohighlight">\(\Delta \Theta\)</span>) are clipped (or <em>wrapped</em>) within
the range <span class="math notranslate nohighlight">\([0 \dotsb 2\pi )\)</span>.
It is necessary to find the integer number of offsets that make a region
continuously smooth with its neighbors (<em>phase-unwrapping</em>, <a class="reference internal" href="#jenkinson2003" id="id5"><span>[Jenkinson2003]</span></a>).</p>
</section>
<section id="pepolar-techniques">
<span id="sdc-pepolar"></span><h3><abbr title="Phase Encoding POLARity">PEPOLAR</abbr> techniques<a class="headerlink" href="#pepolar-techniques" title="Link to this heading">¶</a></h3>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-4-multiple-phase-encoded-directions-pepolar">Types of fieldmaps - Case 4: Multiple phase encoded directions (“pepolar”)</a>.</p>
</div>
<p>Alternatively, it is possible to estimate the field by exploiting the symmetry of the
distortion when the <abbr title="phase-encoding">PE</abbr> polarity is reversed.
<em>SDCFlows</em> integrates two implementations based on FSL <code class="docutils literal notranslate"><span class="pre">topup</span></code> <a class="reference internal" href="#andersson2003" id="id6"><span>[Andersson2003]</span></a>,
and AFNI <code class="docutils literal notranslate"><span class="pre">3dQwarp</span></code> <a class="reference internal" href="#cox1997" id="id7"><span>[Cox1997]</span></a>.
By default, FSL <code class="docutils literal notranslate"><span class="pre">topup</span></code> will be used.</p>
</section>
<section id="fieldmap-less-approaches">
<span id="sdc-fieldmapless"></span><h3>Fieldmap-less approaches<a class="headerlink" href="#fieldmap-less-approaches" title="Link to this heading">¶</a></h3>
<p>Many studies acquired (especially with legacy MRI protocols) do not have any
information to estimate susceptibility-derived distortions.
In the absence of data with the specific purpose of estimating the <span class="math notranslate nohighlight">\(B_0\)</span>
inhomogeneity map, researchers resort to nonlinear registration to an
«<em>anatomically correct</em>» map of the same individual (normally acquired with
<abbr title="T1-weighted">T1w</abbr>, or <abbr title="T2-weighted">T2w</abbr> sequences).
One of the most prominent proposals of this approach is found in <a class="reference internal" href="#studholme2000" id="id8"><span>[Studholme2000]</span></a>.</p>
<p><em>SDCFlows</em> includes an (experimental) procedure, based on nonlinear image registration
with ANTs’ symmetric normalization (SyN) technique.
This workflow takes a skull-stripped <abbr title="T1-weighted">T1w</abbr> image and
a reference <abbr title="Echo-Planar Imaging">EPI</abbr> image, and estimates a field of nonlinear
displacements that accounts for susceptibility-derived distortions.
To more accurately estimate the warping on typically distorted regions, this
implementation uses an average <span class="math notranslate nohighlight">\(B_0\)</span> mapping described in <a class="reference internal" href="#treiber2016" id="id9"><span>[Treiber2016]</span></a>.
The implementation is a variation on those developed in <a class="reference internal" href="#huntenburg2014" id="id10"><span>[Huntenburg2014]</span></a> and
<a class="reference internal" href="#wang2017" id="id11"><span>[Wang2017]</span></a>.</p>
<p>The process is divided in two steps.
First, the two images to be aligned (anatomical and one or more <abbr title="echo-planar imaging">EPI</abbr> sources) are prepared for
registration, including a linear pre-alignment of both, calculation of a 3D <abbr title="echo-planar imaging">EPI</abbr> <em>reference</em> map,
intensity/histogram enhancement, and <em>deobliquing</em> (meaning, for images where the physical
coordinates axes and the data array axes are not aligned, the physical coordinates are
rotated to align with the data array).
Such a preprocessing is implemented in
<a class="reference internal" href="api/sdcflows.workflows.fit.syn.html#sdcflows.workflows.fit.syn.init_syn_preprocessing_wf" title="sdcflows.workflows.fit.syn.init_syn_preprocessing_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_syn_preprocessing_wf()</span></code></a>.
Second, the outputs of the preprocessing workflow are fed into
<a class="reference internal" href="api/sdcflows.workflows.fit.syn.html#sdcflows.workflows.fit.syn.init_syn_sdc_wf" title="sdcflows.workflows.fit.syn.init_syn_sdc_wf"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_syn_sdc_wf()</span></code></a>,
which executes the nonlinear, SyN registration.
To aid the <em>Mattes</em> mutual information cost function, the registration scheme is set up
in <em>multi-channel</em> mode, and laplacian-filtered derivatives of both anatomical and <abbr title="echo-planar imaging">EPI</abbr>
reference are introduced as a second registration channel.
The optimization gradients of the registration process are weighted, so that deformations
effectively possible only along the <abbr title="phase-encoding">PE</abbr> axis.
Given that ANTs’ registration framework performs on physical coordinates, it is necessary
that input images are not <em>oblique</em>.
The anatomical image is used as <em>fixed image</em>, and therefore, the registration process
estimates the transformation function from <em>unwarped</em> (anatomically <em>correct</em>) coordinates
to <em>distorted</em> coordinates.
If fed into <code class="docutils literal notranslate"><span class="pre">antsApplyTransforms</span></code>, the resulting transform will effectively <em>unwarp</em> a distorted
<abbr title="echo-planar imaging">EPI</abbr> given as input into its <em>unwarped</em> mapping.
The estimated transform is then converted into a <span class="math notranslate nohighlight">\(B_0\)</span> fieldmap in Hz, which can be
stored within the derivatives folder.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>This procedure is experimental, and the outcomes should be scrutinized one-by-one
and used with caution.
Feedback will be enthusiastically received.</p>
</div>
</section>
<section id="other-unsupported-approaches">
<h3>Other (unsupported) approaches<a class="headerlink" href="#other-unsupported-approaches" title="Link to this heading">¶</a></h3>
<p>There exist some alternative options to estimate the fieldmap, such as mapping the
point-spread-function <a class="reference internal" href="#zaitsev2004" id="id12"><span>[Zaitsev2004]</span></a>, or by means of nonlinear registration of brain
surfaces onto the distorted <abbr title="echo-planar imaging">EPI</abbr> data <a class="reference internal" href="#esteban2016" id="id13"><span>[Esteban2016]</span></a>.</p>
</section>
<section id="estimation-tooling">
<h3>Estimation tooling<a class="headerlink" href="#estimation-tooling" title="Link to this heading">¶</a></h3>
<p>The workflows provided by <a class="reference internal" href="api/sdcflows.workflows.fit.html#module-sdcflows.workflows.fit" title="sdcflows.workflows.fit"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdcflows.workflows.fit</span></code></a> make use of several utilities.
The cornerstone of these tools is the fieldmap representation with B-Splines
(<a class="reference internal" href="api/sdcflows.interfaces.bspline.html#module-sdcflows.interfaces.bspline" title="sdcflows.interfaces.bspline"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdcflows.interfaces.bspline</span></code></a>).
B-Splines are well-suited to plausibly smooth the fieldmap and provide a compact
representation of the field with fewer parameters.
This representation is also more accurate in the case the images that were used for estimation
are not aligned with the target images to be corrected because the fieldmap is not directly
interpolated in the projection, but rather, the position of the coefficients in space is
updated and then the fieldmap reconstructed.</p>
</section>
</section>
<section id="unwarping-the-distorted-data">
<h2>Unwarping the distorted data<a class="headerlink" href="#unwarping-the-distorted-data" title="Link to this heading">¶</a></h2>
<p><a class="reference internal" href="api/sdcflows.workflows.apply.html#module-sdcflows.workflows.apply" title="sdcflows.workflows.apply"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sdcflows.workflows.apply</span></code></a> contains workflows to project fieldmaps represented by B-Spline
basis into the space of the target <abbr title="echo-planar imaging">EPI</abbr> data.</p>
</section>
<section id="discovering-fieldmaps-in-a-bids-dataset">
<h2>Discovering fieldmaps in a BIDS dataset<a class="headerlink" href="#discovering-fieldmaps-in-a-bids-dataset" title="Link to this heading">¶</a></h2>
<p>To ease the implementation of higher-level pipelines integrating <abbr title="susceptibility distortion correction">SDC</abbr>,
<em>SDCFlows</em> provides <a class="reference internal" href="api/sdcflows.utils.wrangler.html#sdcflows.utils.wrangler.find_estimators" title="sdcflows.utils.wrangler.find_estimators"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdcflows.utils.wrangler.find_estimators()</span></code></a>.</p>
<section id="explicit-specification-with-b0fieldidentifier">
<h3>Explicit specification with <code class="docutils literal notranslate"><span class="pre">B0FieldIdentifier</span></code><a class="headerlink" href="#explicit-specification-with-b0fieldidentifier" title="Link to this heading">¶</a></h3>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#using-b0fieldidentifier-metadata">Expressing the MR protocol intent for fieldmaps - Using *B0FieldIdentifier* metadata</a>.</p>
</div>
<p>If one or more <code class="docutils literal notranslate"><span class="pre">B0FieldIdentifier</span></code>(s) are set within the input metadata (following BIDS’ specifications),
then corresponding estimators will be built from the available input data.</p>
</section>
<section id="implicit-specification-with-intendedfor">
<h3>Implicit specification with <code class="docutils literal notranslate"><span class="pre">IntendedFor</span></code><a class="headerlink" href="#implicit-specification-with-intendedfor" title="Link to this heading">¶</a></h3>
<div class="admonition-bids-specification admonition">
<p class="admonition-title">BIDS Specification</p>
<p>See the section <a class="reference external" href="https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#using-intendedfor-metadata">Expressing the MR protocol intent for fieldmaps - Using *IntendedFor* metadata</a>.</p>
</div>
<p>In the case no <code class="docutils literal notranslate"><span class="pre">B0FieldIdentifier</span></code>(s) are defined, then <em>SDCFlows</em> will try to identify as many fieldmap
estimators as possible within the dataset following a set of heuristics.
Then, those estimators may be linked to target <abbr title="echo-planar imaging">EPI</abbr> data by interpreting the
<code class="docutils literal notranslate"><span class="pre">IntendedFor</span></code> field if available.</p>
</section>
<section id="fieldmap-less-by-registration-to-a-t1-weighted-image">
<h3>Fieldmap-less by registration to a T1-weighted image<a class="headerlink" href="#fieldmap-less-by-registration-to-a-t1-weighted-image" title="Link to this heading">¶</a></h3>
<p>If none of the two previous options yielded any workable estimation strategy, and provided that
the argument <code class="docutils literal notranslate"><span class="pre">fmapless</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then <a class="reference internal" href="api/sdcflows.utils.wrangler.html#sdcflows.utils.wrangler.find_estimators" title="sdcflows.utils.wrangler.find_estimators"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_estimators()</span></code></a>
will attempt to find <abbr title="blood-oxygen level-dependent">BOLD</abbr> or <abbr title="diffusion-weighted imaging">DWI</abbr>
instances within single sessions that are consistent in <abbr title="phase-encoding">PE</abbr> direction and
<em>total readout time</em>, assuming they have been acquired with the same shimming settings.</p>
<p>If one or more anatomical images are found, and if the search for candidate
<abbr title="blood-oxygen level-dependent">BOLD</abbr> or <abbr title="diffusion-weighted imaging">DWI</abbr> data
yields results, then corresponding fieldmap-less estimators are set up.</p>
<p>It is possible to force the fieldmap-less estimation by passing <code class="docutils literal notranslate"><span class="pre">force_fmapless=True</span></code> to the
<a class="reference internal" href="api/sdcflows.utils.wrangler.html#sdcflows.utils.wrangler.find_estimators" title="sdcflows.utils.wrangler.find_estimators"><code class="xref py py-func docutils literal notranslate"><span class="pre">find_estimators()</span></code></a> utility.</p>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h2>
<div role="list" class="citation-list">
<div class="citation" id="jezzard1995" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">Jezzard1995</a><span class="fn-bracket">]</span></span>
<p>Jezzard, P. &amp; Balaban, R. S. (1995) Correction for geometric distortion in
echo planar images from B0 field variations. Magn. Reson. Med. 34:65–73.
doi:<a class="reference external" href="https://doi.org/10.1002/mrm.1910340111">10.1002/mrm.1910340111</a>.</p>
</div>
<div class="citation" id="hutton2002" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Hutton2002<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id3">2</a>,<a role="doc-backlink" href="#id4">3</a>)</span>
<p>Hutton et al., (2002) Image Distortion Correction in fMRI: A Quantitative
Evaluation, NeuroImage 16(1):217-240. doi:<a class="reference external" href="https://doi.org/10.1006/nimg.2001.1054">10.1006/nimg.2001.1054</a>.</p>
</div>
<div class="citation" id="jenkinson2003" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">Jenkinson2003</a><span class="fn-bracket">]</span></span>
<p>Jenkinson, M. (2003) Fast, automated, N-dimensional phase-unwrapping
algorithm. MRM 49(1):193-197. doi:<a class="reference external" href="https://doi.org/10.1002/mrm.10354">10.1002/mrm.10354</a>.</p>
</div>
<div class="citation" id="andersson2003" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">Andersson2003</a><span class="fn-bracket">]</span></span>
<p>Andersson, J. (2003) How to correct susceptibility distortions in spin-echo
echo-planar images: application to diffusion tensor imaging. NeuroImage 20:870–888.
doi:<a class="reference external" href="https://doi.org/10.1016/s1053-8119(03)00336-7">10.1016/s1053-8119(03)00336-7</a>.</p>
</div>
<div class="citation" id="cox1997" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">Cox1997</a><span class="fn-bracket">]</span></span>
<p>Cox, R. (1997) Software tools for analysis and visualization of fMRI data. NMR Biomed.
10:171–178, doi:<a class="reference external" href="https://doi.org/10.1002/(sici)1099-1492(199706/08)10:4/5%3C171::aid-nbm453%3E3.0.co;2-l">10.1002/(sici)1099-1492(199706/08)10:4/5%3C171::aid-nbm453%3E3.0.co;2-l</a>.</p>
</div>
<div class="citation" id="studholme2000" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">Studholme2000</a><span class="fn-bracket">]</span></span>
<p>Studholme et al. (2000) Accurate alignment of functional EPI data to
anatomical MRI using a physics-based distortion model,
IEEE Trans Med Imag 19(11):1115-1127, 2000, doi: <a class="reference external" href="https://doi.org/10.1109/42.896788">10.1109/42.896788</a>.</p>
</div>
<div class="citation" id="treiber2016" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">Treiber2016</a><span class="fn-bracket">]</span></span>
<p>Treiber, J. M. et al. (2016) Characterization and Correction
of Geometric Distortions in 814 Diffusion Weighted Images,
PLoS ONE 11(3): e0152472. doi:<a class="reference external" href="https://doi.org/10.1371/journal.pone.0152472">10.1371/journal.pone.0152472</a>.</p>
</div>
<div class="citation" id="wang2017" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">Wang2017</a><span class="fn-bracket">]</span></span>
<p>Wang S, et al. (2017) Evaluation of Field Map and Nonlinear
Registration Methods for Correction of Susceptibility Artifacts
in Diffusion MRI. Front. Neuroinform. 11:17.
doi:<a class="reference external" href="https://doi.org/10.3389/fninf.2017.00017">10.3389/fninf.2017.00017</a>.</p>
</div>
<div class="citation" id="huntenburg2014" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">Huntenburg2014</a><span class="fn-bracket">]</span></span>
<p>Huntenburg, J. M. (2014) <a class="reference external" href="http://pubman.mpdl.mpg.de/pubman/item/escidoc:2327525:5/component/escidoc:2327523/master_thesis_huntenburg_4686947.pdf">Evaluating Nonlinear
Coregistration of BOLD EPI and T1w Images</a>,
Berlin: Master Thesis, Freie Universität.</p>
</div>
<div class="citation" id="zaitsev2004" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">Zaitsev2004</a><span class="fn-bracket">]</span></span>
<p>Zaitsev, M. (2004) Point spread function mapping with parallel imaging techniques and
high acceleration factors: Fast, robust, and flexible method for echo-planar imaging distortion correction,
MRM 52(5):1156-1166. doi:<a class="reference external" href="https://doi.org/10.1002/mrm.20261">10.1002/mrm.20261</a>.</p>
</div>
<div class="citation" id="esteban2016" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">Esteban2016</a><span class="fn-bracket">]</span></span>
<p>Esteban, O. (2016) Surface-driven registration method for the structure-informed segmentation
of diffusion MR images. NeuroImage 139:450-461.
doi:<a class="reference external" href="https://doi.org/10.1016/j.neuroimage.2016.05.011">10.1016/j.neuroimage.2016.05.011</a>.</p>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cli.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Standalone command line usage</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="notebooks/SDC%20-%20Theory%20and%20physics.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Susceptibility Distortions in a nutshell</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, The NiPreps developers
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Methods and implementation</a><ul>
<li><a class="reference internal" href="#fieldmap-estimation-theory-and-methods">Fieldmap estimation: theory and methods</a><ul>
<li><a class="reference internal" href="#direct-b0-mapping-sequences">Direct B0 mapping sequences</a></li>
<li><a class="reference internal" href="#phase-difference-b0-estimation">Phase-difference B0 estimation</a></li>
<li><a class="reference internal" href="#pepolar-techniques"><abbr title="Phase Encoding POLARity">PEPOLAR</abbr> techniques</a></li>
<li><a class="reference internal" href="#fieldmap-less-approaches">Fieldmap-less approaches</a></li>
<li><a class="reference internal" href="#other-unsupported-approaches">Other (unsupported) approaches</a></li>
<li><a class="reference internal" href="#estimation-tooling">Estimation tooling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unwarping-the-distorted-data">Unwarping the distorted data</a></li>
<li><a class="reference internal" href="#discovering-fieldmaps-in-a-bids-dataset">Discovering fieldmaps in a BIDS dataset</a><ul>
<li><a class="reference internal" href="#explicit-specification-with-b0fieldidentifier">Explicit specification with <code class="docutils literal notranslate"><span class="pre">B0FieldIdentifier</span></code></a></li>
<li><a class="reference internal" href="#implicit-specification-with-intendedfor">Implicit specification with <code class="docutils literal notranslate"><span class="pre">IntendedFor</span></code></a></li>
<li><a class="reference internal" href="#fieldmap-less-by-registration-to-a-t1-weighted-image">Fieldmap-less by registration to a T1-weighted image</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=27db1736"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/version-switch.js?v=d8b55535"></script>
    </body>
</html>